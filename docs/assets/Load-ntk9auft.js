import{V as R,_ as G}from"./VSnackbar-DB48DWtY.js";import{a8 as D,a3 as u,a9 as H,a6 as b,at as J,aa as C,l as o,ab as l,ac as P,$,ar as z,ad as x,ae as m,ah as g,aj as f,as as B,au as F,ap as w,am as U,av as q,ai as S,al as K,aw as Q,an as W,af as X,ao as Y,aq as Z,n as tt}from"./index-Cc4k-TfZ.js";import{B as at}from"./BoxContainer-D4yWl1HP.js";const et={class:"image-scan-container"},ot=["src"],lt="이미지 분석 중...",st="당신의 SNS 무디멀 유형은?<br>SNS 이미지를 분석하고 있어요.",nt={__name:"Load",emits:["restart-analyze"],setup(it,{emit:ct}){const p=z(),I=u(["당신의 마음 속 무디멀스를 찾아가고 있어요...","쉿, 당신의 무디멀이 둥지에서 나올 준비를 하고 있어요...","우하하! 당신의 유머 감각을 분석 중이에요...","AI도 커피 한 잔 할 시간이 필요해요... 잠시만요!","아주 흥미로운 표현이네요. 제 알고리즘이 감탄했어요...","당신과 꼭 맞는 무디멀스가 깨어나고 있어요...","이 화면 속 당신의 섬세함을 읽어내는 중..."]),d=u(0);let v=null;const c=u({title:"",text:"",dialogActive:!1,okButton(){}}),V=u("https://placehold.co/600x400"),_=u(400);u(!0);const L=u(""),y=u(!1);H(async()=>{var r;const s=sessionStorage.getItem("uploadImg");if(!s){T("알림","업로드된 이미지가 없습니다. 처음부터 다시 시도해주세요.",()=>{c.value.dialogActive=!1,p.push("/")});return}V.value=s,await b();const a=new Image;a.onload=()=>{const i=document.querySelector(".scan-image");i&&(_.value=i.offsetHeight)},a.src=s,v=setInterval(()=>{d.value=(d.value+1)%I.value.length},2e3);const t=M();try{await j(t);const i=localStorage.getItem("moodimalResult");let e="";try{const n=JSON.parse(i);e=(n==null?void 0:n.moodimal)||((r=n==null?void 0:n.data)==null?void 0:r.moodimal)||""}catch{e=""}e&&await A(e),p.push("/end")}catch(i){console.error("[Load] LLM 분석 실패:",i),T("오류","결과를 불러오는 중 오류가 발생했습니다.",()=>{c.value.dialogActive=!1,p.push("/")})}await b()}),J(()=>{v&&clearInterval(v)});function M(){var s;try{const a=localStorage.getItem("ocrResult");if(!a)return"";let t;try{t=JSON.parse(a)}catch{t=a}return((typeof t=="string"?t:((s=t==null?void 0:t.data)==null?void 0:s.text)??(t==null?void 0:t.ParsedText)??(t==null?void 0:t.text)??"")||"").toString().trim()}catch(a){return console.error("fail get ocrResult:",a),""}}async function j(s){var k,N;const a=Date.now(),t="/api/v1/generate/llm/analyze",r={tid:a,text:String(s||"")},i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw new Error(`HTTP ${i.status}`);const e=await i.json(),n=((k=e==null?void 0:e.status)==null?void 0:k.code)??"E0500";if(n!=="S0000")throw new Error(`API ${n}: ${(N=e==null?void 0:e.status)==null?void 0:N.msg}`);const h=(e==null?void 0:e.data)??{},O=typeof h=="string"?h:JSON.stringify(h);localStorage.setItem("moodimalResult",O)}async function A(s){var i;const a=Date.now(),t="/api/v1/generate/llm/img_general",r={tid:a,moodimal:s};console.log("[IMG_GEN] 요청 payload:",r);try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`이미지 생성 실패 (${e.status})`);const n=await e.json();console.log("[IMG_GEN] 생성 결과:",n),(i=n==null?void 0:n.data)!=null&&i.image&&localStorage.setItem("moodimalImage",n.data.image)}catch(e){console.error("[IMG_GEN] 이미지 생성 중 오류:",e)}}function T(s,a,t){c.value.title=s,c.value.text=a,c.value.okButton=typeof t=="function"?t:()=>{},c.value.dialogActive=!0}function E(s){s||(y.value=!1,console.log("Snackbar 닫힘"))}return(s,a)=>{const t=G;return x(),C($,null,[o(at,null,{default:l(()=>[o(t,{title:lt,desc:st}),o(m,{"no-gutters":"",class:"justify-center | mt-9"},{default:l(()=>[o(g,{"no-gutters":""},{default:l(()=>[f("div",et,[f("img",{src:V.value,alt:"Uploaded preview",class:"scan-image"},null,8,ot),f("div",{class:"scan-line",style:B({"--scan-height":_.value+"px"})},null,4),f("div",{class:"scan-overlay",style:B({"--scan-height":_.value+"px"})},null,4)])]),_:1})]),_:1}),o(m,{"no-gutters":"",class:"justify-center | mt-6"},{default:l(()=>[o(g,{class:"info-text-container"},{default:l(()=>[o(F,{name:"slide-fade",mode:"out-in"},{default:l(()=>[(x(),C("div",{key:d.value,class:"info-text"},w(I.value[d.value]),1))]),_:1})]),_:1})]),_:1})]),_:1}),o(P,{modelValue:c.value.dialogActive,"onUpdate:modelValue":a[0]||(a[0]=r=>c.value.dialogActive=r),width:"auto"},{default:l(()=>[o(U,{class:"pa-2 | pb-3",rounded:"lg"},{actions:l(()=>[o(m,{"no-gutters":"",justify:"end"},{default:l(()=>[c.value.okButton?(x(),q(K,{key:0,color:"#FF794C",width:"25%",rounded:"xl",variant:"flat",class:"ml-2",onClick:c.value.okButton},{default:l(()=>a[2]||(a[2]=[S("확인")])),_:1},8,["onClick"])):Q("",!0)]),_:1})]),default:l(()=>[o(W,{class:"text-title | pl-4 | pr-4 | pt-4"},{default:l(()=>[o(m,{style:{"justify-content":"start","align-items":"center"}},{default:l(()=>[o(g,{class:"pt-0 | pb-0 | pl-4 | pr-1",cols:"auto"},{default:l(()=>[o(X,{src:Y,height:"24",width:"24",class:""})]),_:1}),o(g,{class:"pl-1",cols:"auto"},{default:l(()=>[S(w(c.value.title),1)]),_:1})]),_:1})]),_:1}),o(Z,{class:"text-subtitle | pl-4 | pr-4 | pt-2 | pb-3",innerHTML:c.value.text},null,8,["innerHTML"])]),_:1})]),_:1},8,["modelValue"]),o(R,{modelValue:y.value,"onUpdate:modelValue":[a[1]||(a[1]=r=>y.value=r),E],timeout:3e3,color:"white",rounded:"pill",class:"mb-12"},{default:l(()=>[o(tt,{color:"info",icon:"mdi-information",class:"mr-2"}),S(" "+w(L.value),1)]),_:1},8,["modelValue"])],64)}}},mt=D(nt,[["__scopeId","data-v-2eb40c69"]]);export{mt as default};
