import{B as R,V as E,_ as z}from"./VSnackbar-DJT4H80n.js";import{a6 as D,s as i,W as F,Y as C,aq as P,a7 as B,b as a,a8 as o,a9 as U,H as $,ao as J,aa as y,ab as d,ae as f,ag as m,ap as L,ar as q,am as h,aj as W,as as Y,af as S,ai as G,at as K,ak as Q,ac as X,al as Z,an as tt,f as et}from"./index-BpGNbwJ9.js";const at={class:"image-scan-container"},ot=["src"],st="이미지 분석 중...",lt="당신의 SNS 무디멀 유형은?<br>SNS 이미지를 분석하고 있어요.",nt={__name:"Load",emits:["restart-analyze"],setup(ct,{emit:it}){const g=J(),w=i(["당신의 마음 속 무디멀스를 찾아가고 있어요...","쉿, 당신의 무디멀이 둥지에서 나올 준비를 하고 있어요...","우하하! 당신의 유머 감각을 분석 중이에요...","AI도 커피 한 잔 할 시간이 필요해요... 잠시만요!","아주 흥미로운 표현이네요. 제 알고리즘이 감탄했어요...","당신과 꼭 맞는 무디멀스가 깨어나고 있어요...","이 화면 속 당신의 섬세함을 읽어내는 중..."]),r=i(0);let p=null;const l=i({title:"",text:"",dialogActive:!1,okButton(){}}),V=i("https://placehold.co/600x400"),v=i(400);i(!0);const A=i(""),_=i(!1);F(async()=>{const s=sessionStorage.getItem("uploadImg");if(s){V.value=s,await C();const t=new Image;t.onload=()=>{const n=document.querySelector(".scan-image");n&&(v.value=n.offsetHeight)},t.src=s}p=setInterval(()=>{r.value=(r.value+1)%w.value.length},2e3);const e=N();if(!e){k("알림","OCR 결과가 없습니다. 처음부터 다시 시도해주세요.",()=>{l.value.dialogActive=!1,g.push("/")});return}try{await j(e),g.push("/end")}catch(t){console.error("[Load] LLM 분석 실패:",t),k("오류","결과를 불러오는 중 오류가 발생했습니다.",()=>{l.value.dialogActive=!1,g.push("/")})}await C()}),P(()=>{p&&clearInterval(p)});function N(){var s;try{const e=localStorage.getItem("ocrResult");if(!e)return"";let t;try{t=JSON.parse(e)}catch{t=e}return((typeof t=="string"?t:((s=t==null?void 0:t.data)==null?void 0:s.text)??(t==null?void 0:t.ParsedText)??(t==null?void 0:t.text)??"")||"").toString().trim()}catch(e){return console.error("fail get ocrResult:",e),""}}async function j(s){var I,b;const e=Date.now(),t="/api/v1/generate/llm/analyze",n={tid:e,text:String(s||"")},u=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!u.ok){const O=await u.text().catch(()=>"");throw new Error(`HTTP ${u.status} ${O}`)}const c=await u.json(),T=((I=c==null?void 0:c.status)==null?void 0:I.code)??"E0500";if(T!=="S0000")throw new Error(`API ${T}: ${((b=c==null?void 0:c.status)==null?void 0:b.msg)||"unknown error"}`);const x=(c==null?void 0:c.data)??{},M=typeof x=="string"?x:JSON.stringify(x);localStorage.setItem("moodimalResult",M)}function k(s,e,t){l.value.title=s,l.value.text=e,l.value.okButton=typeof t=="function"?t:()=>{},l.value.dialogActive=!0}function H(s){s||(_.value=!1,console.log("Snackbar 닫힘"))}return(s,e)=>{const t=z;return y(),B($,null,[a(R,null,{default:o(()=>[a(t,{title:st,desc:lt}),a(d,{"no-gutters":"",class:"justify-center | mt-9"},{default:o(()=>[a(f,{"no-gutters":""},{default:o(()=>[m("div",at,[m("img",{src:V.value,alt:"Uploaded preview",class:"scan-image"},null,8,ot),m("div",{class:"scan-line",style:L({"--scan-height":v.value+"px"})},null,4),m("div",{class:"scan-overlay",style:L({"--scan-height":v.value+"px"})},null,4)])]),_:1})]),_:1}),a(d,{"no-gutters":"",class:"justify-center | mt-6"},{default:o(()=>[a(f,{class:"info-text-container"},{default:o(()=>[a(q,{name:"slide-fade",mode:"out-in"},{default:o(()=>[(y(),B("div",{key:r.value,class:"info-text"},h(w.value[r.value]),1))]),_:1})]),_:1})]),_:1})]),_:1}),a(U,{modelValue:l.value.dialogActive,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.dialogActive=n),width:"auto"},{default:o(()=>[a(W,{class:"pa-2 | pb-3",rounded:"lg"},{actions:o(()=>[a(d,{"no-gutters":"",justify:"end"},{default:o(()=>[l.value.okButton?(y(),Y(G,{key:0,color:"#FF794C",width:"25%",rounded:"xl",variant:"flat",class:"ml-2",onClick:l.value.okButton},{default:o(()=>e[2]||(e[2]=[S("확인")])),_:1},8,["onClick"])):K("",!0)]),_:1})]),default:o(()=>[a(Q,{class:"text-title | pl-4 | pr-4 | pt-4"},{default:o(()=>[a(d,{style:{"justify-content":"start","align-items":"center"}},{default:o(()=>[a(f,{class:"pt-0 | pb-0 | pl-4 | pr-1",cols:"auto"},{default:o(()=>[a(X,{src:Z,height:"24",width:"24",class:""})]),_:1}),a(f,{class:"pl-1",cols:"auto"},{default:o(()=>[S(h(l.value.title),1)]),_:1})]),_:1})]),_:1}),a(tt,{class:"text-subtitle | pl-4 | pr-4 | pt-2 | pb-3",innerHTML:l.value.text},null,8,["innerHTML"])]),_:1})]),_:1},8,["modelValue"]),a(E,{modelValue:_.value,"onUpdate:modelValue":[e[1]||(e[1]=n=>_.value=n),H],timeout:3e3,color:"white",rounded:"pill",class:"mb-12"},{default:o(()=>[a(et,{color:"info",icon:"mdi-information",class:"mr-2"}),S(" "+h(A.value),1)]),_:1},8,["modelValue"])],64)}}},dt=D(nt,[["__scopeId","data-v-159a701a"]]);export{dt as default};
