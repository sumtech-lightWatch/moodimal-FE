import{V as O,_ as R}from"./VSnackbar-BsteRcD7.js";import{a8 as G,a3 as u,a9 as $,a6 as D,at as H,aa as b,l,ab as n,ac as J,$ as P,ar as z,ad as x,ae as m,ah as g,aj as f,as as C,au as F,ap as w,am as U,av as q,ai as S,al as K,aw as Q,an as W,af as X,ao as Y,aq as Z,n as tt}from"./index-DI2aBRzA.js";import{B as et}from"./BoxContainer-DP_nMTvN.js";const at={class:"image-scan-container"},ot=["src"],lt="이미지 분석 중...",nt="당신의 SNS 무디멀 유형은?<br>SNS 이미지를 분석하고 있어요.",st={__name:"Load",emits:["restart-analyze"],setup(ct,{emit:it}){const p=z(),I=u(["당신의 마음 속 무디멀스를 찾아가고 있어요...","쉿, 당신의 무디멀이 둥지에서 나올 준비를 하고 있어요...","우하하! 당신의 유머 감각을 분석 중이에요...","AI도 커피 한 잔 할 시간이 필요해요... 잠시만요!","아주 흥미로운 표현이네요. 제 알고리즘이 감탄했어요...","당신과 꼭 맞는 무디멀스가 깨어나고 있어요...","이 화면 속 당신의 섬세함을 읽어내는 중..."]),d=u(0);let v=null;const i=u({title:"",text:"",dialogActive:!1,okButton(){}}),V=u("https://placehold.co/600x400"),_=u(400);u(!0);const L=u(""),h=u(!1);$(async()=>{const s=sessionStorage.getItem("uploadImg");if(!s){T("알림","업로드된 이미지가 없습니다. 처음부터 다시 시도해주세요.",()=>{i.value.dialogActive=!1,p.push("/")});return}V.value=s,await D();const e=new Image;e.onload=()=>{const a=document.querySelector(".scan-image");a&&(_.value=a.offsetHeight)},e.src=s,v=setInterval(()=>{d.value=(d.value+1)%I.value.length},2e3);const t=B();E(t).then(()=>{var o;const a=localStorage.getItem("moodimalResult");let r="";try{const c=JSON.parse(a);r=(c==null?void 0:c.moodimal)||((o=c==null?void 0:c.data)==null?void 0:o.moodimal)||""}catch{r=""}if(!r)throw console.error("[Load] LLM 분석 결과에서 moodimal 이름을 찾을 수 없습니다."),new Error("분석 결과에서 무디멀 유형을 찾지 못했습니다.");return M(r)}).then(()=>{if(!localStorage.getItem("moodimalImage"))throw new Error("이미지 생성에 성공했으나, 저장된 이미지가 없습니다.");console.log("[Load] 모든 분석 및 생성 완료. /end 페이지로 이동"),p.push("/end")}).catch(a=>{console.error("[Load] 분석 프로세스 실패:",a),T("오류",`결과를 불러오는 중 오류가 발생했습니다.<br>(${a.message||"다시 시도해주세요."})`,()=>{i.value.dialogActive=!1,p.push("/")})})}),H(()=>{v&&clearInterval(v)});function B(){var s;try{const e=localStorage.getItem("ocrResult");if(!e)return"";let t;try{t=JSON.parse(e)}catch{t=e}return((typeof t=="string"?t:((s=t==null?void 0:t.data)==null?void 0:s.text)??(t==null?void 0:t.ParsedText)??(t==null?void 0:t.text)??"")||"").toString().trim()}catch(e){return console.error("fail get ocrResult:",e),""}}async function E(s){var k,N;const e=Date.now(),t="/api/v1/generate/llm/analyze",a={tid:e,text:String(s||"")},r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error(`HTTP ${r.status}`);const o=await r.json(),c=((k=o==null?void 0:o.status)==null?void 0:k.code)??"E0500";if(c!=="S0000")throw new Error(`API ${c}: ${(N=o==null?void 0:o.status)==null?void 0:N.msg}`);const y=(o==null?void 0:o.data)??{},A=typeof y=="string"?y:JSON.stringify(y);localStorage.setItem("moodimalResult",A)}async function M(s){var r;const e=Date.now(),t="/api/v1/generate/llm/img_general",a={tid:e,moodimal:s};console.log("[IMG_GEN] 요청 payload:",a);try{const o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok)throw new Error(`이미지 생성 실패 (${o.status})`);const c=await o.json();console.log("[IMG_GEN] 생성 결과:",c),(r=c==null?void 0:c.data)!=null&&r.image&&localStorage.setItem("moodimalImage",c.data.image)}catch(o){console.error("[IMG_GEN] 이미지 생성 중 오류:",o)}}function T(s,e,t){i.value.title=s,i.value.text=e,i.value.okButton=typeof t=="function"?t:()=>{},i.value.dialogActive=!0}function j(s){s||(h.value=!1,console.log("Snackbar 닫힘"))}return(s,e)=>{const t=R;return x(),b(P,null,[l(et,null,{default:n(()=>[l(t,{title:lt,desc:nt}),l(m,{"no-gutters":"",class:"justify-center | mt-5"},{default:n(()=>[l(g,{"no-gutters":"",cols:"8"},{default:n(()=>[f("div",at,[f("img",{src:V.value,alt:"Uploaded preview",class:"scan-image"},null,8,ot),f("div",{class:"scan-line",style:C({"--scan-height":_.value+"px"})},null,4),f("div",{class:"scan-overlay",style:C({"--scan-height":_.value+"px"})},null,4)])]),_:1})]),_:1}),l(m,{"no-gutters":"",class:"justify-center | mt-4"},{default:n(()=>[l(g,{class:"info-text-container"},{default:n(()=>[l(F,{name:"slide-fade",mode:"out-in"},{default:n(()=>[(x(),b("div",{key:d.value,class:"info-text"},w(I.value[d.value]),1))]),_:1})]),_:1})]),_:1})]),_:1}),l(J,{modelValue:i.value.dialogActive,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.dialogActive=a),width:"auto"},{default:n(()=>[l(U,{class:"pa-2 | pb-3",rounded:"lg"},{actions:n(()=>[l(m,{"no-gutters":"",justify:"end"},{default:n(()=>[i.value.okButton?(x(),q(K,{key:0,color:"#FF794C",width:"25%",rounded:"xl",variant:"flat",class:"ml-2",onClick:i.value.okButton},{default:n(()=>e[2]||(e[2]=[S("확인")])),_:1},8,["onClick"])):Q("",!0)]),_:1})]),default:n(()=>[l(W,{class:"text-title | pl-4 | pr-4 | pt-4"},{default:n(()=>[l(m,{style:{"justify-content":"start","align-items":"center"}},{default:n(()=>[l(g,{class:"pt-0 | pb-0 | pl-4 | pr-1",cols:"auto"},{default:n(()=>[l(X,{src:Y,height:"24",width:"24",class:""})]),_:1}),l(g,{class:"pl-1",cols:"auto"},{default:n(()=>[S(w(i.value.title),1)]),_:1})]),_:1})]),_:1}),l(Z,{class:"text-subtitle | pl-4 | pr-4 | pt-2 | pb-3",innerHTML:i.value.text},null,8,["innerHTML"])]),_:1})]),_:1},8,["modelValue"]),l(O,{modelValue:h.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>h.value=a),j],timeout:3e3,color:"white",rounded:"pill",class:"mb-12"},{default:n(()=>[l(tt,{color:"info",icon:"mdi-information",class:"mr-2"}),S(" "+w(L.value),1)]),_:1},8,["modelValue"])],64)}}},mt=G(st,[["__scopeId","data-v-0e1d96d2"]]);export{mt as default};
